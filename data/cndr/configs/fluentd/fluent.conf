<source>
  @type tail
  path /var/log/suricata/eve.json
  pos_file /fluentd/log/td-agent/eve-nsm-0.json.pos
  tag suricata.tail
  <parse>
    @type json
    time_format %Y-%m-%dT%H:%M:%S.%NZ
  </parse>
</source>

<label @FLUENT_LOG>
  <match fluent.*>
    @type stdout
  </match>
</label>

# <match suricata.tail>
#   @type rewrite_tag_filter
#   enable_ruby true
#   <rule>
#     key event_type
#     pattern /^\[(\w+)\]/
#     tag suricata.$1
#   </rule>
# </match>

<match suricata.**>
  @type opensearch
  host elasticsearch
  port 9200
  logstash_format true
  logstash_prefix logstash-${event_type}
  # index_name logstash-${event_type}
  include_tag_key true

  template_name template_1
  template_file /fluentd/etc/template.json

  <buffer tag,event_type>
    flush_at_shutdown true
    flush_mode immediate
    flush_thread_count 8
  </buffer>
</match>
